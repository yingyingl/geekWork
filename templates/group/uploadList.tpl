

<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <!--<link rel="alternate" media="handheld" href="http://m.insgeek.com//UploadUserInfo/upload_sure" />-->
    <link rel="shortcut icon" href="http://www.insgeek.com/favicon.ico"/>
    <link rel="bookmark" href="http://www.insgeek.com/favicon.ico"/>
    <link href="http://www.insgeek.com/public/insgeek2.0/css/bootstrap.min.css?var=2.3.8" rel="stylesheet">
    <link href="http://www.insgeek.com/public/insgeek2.0/font-awesome/css/font-awesome.css?var=2.3.8" rel="stylesheet">
    <!--图片浏览样式-->
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/blueimp/css/blueimp-gallery.min.css?var=2.3.8" rel="stylesheet">
    <!-- Sweet Alert -->
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/sweetalert/sweetalert.css?var=2.3.8" rel="stylesheet">
    <!-- 日期组件样式表 -->
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/datapicker/datepicker3.css?var=2.3.8" rel="stylesheet">
    <!-- 流程组件样式-->
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/steps/jquery.steps.css?var=2.3.8" rel="stylesheet">
    <!-- FooTable -->
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/footable/footable.core.css?var=2.3.8" rel="stylesheet">
    <!-- Morris -->
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/morris/morris-0.4.3.min.css?var=2.3.8" rel="stylesheet">
    <link href="http://www.insgeek.com/public/insgeek2.0/css/animate.css?var=2.3.8" rel="stylesheet">
    <link href="http://www.insgeek.com/public/insgeek2.0/css/style.css?var=2.3.8" rel="stylesheet">
    <link href="http://www.insgeek.com/public/insgeek2.0/css/insgeek.css?var=2.3.8" rel="stylesheet">
    <!--drag-->
    <link rel="stylesheet" href="http://www.insgeek.com/public/insgeek2.0/css/plugins/drag/drag.css?var=2.3.8">
    <!-- Toastr style -->
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/iCheck/custom.css?var=2.3.8" rel="stylesheet">
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/datapicker/datepicker3.css?var=2.3.8" rel="stylesheet">
    <!--slick-->
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/slick/slick.css?var=2.3.8" rel="stylesheet">
    <link href="http://www.insgeek.com/public/insgeek2.0/css/plugins/slick/slick-theme.css?var=2.3.8" rel="stylesheet">
    <!-- Mainly scripts -->
    <script src="http://www.insgeek.com/public/insgeek2.0/js/jquery-2.1.1.js"></script>
    <script src="http://www.insgeek.com/public/insgeek2.0/js/bootstrap.min.js"></script>
    <script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <!-- Topup -->
    <script type="text/javascript" src="http://www.insgeek.com/public/insgeek2.0/js/topup.js"></script>
    <!-- 浮动菜单 -->
    <script type="text/javascript" src="http://www.insgeek.com/public/insgeek2.0/js/zzsc.js"></script>
    <script type="text/javascript" src="http://www.insgeek.com/public/js/common_ajax.js"></script>
    <!-- login -->
    <script src="http://www.insgeek.com/public/insgeek2.0/js/igCustom.js"></script>
    <script src="http://www.insgeek.com/public/insgeek2.0/js/login/login.js"></script>
    <!--[if lt IE 9]>
    <div class="alert alert-danger topframe" role="alert">您的浏览器实在<strong>太旧了！</strong>，请先升级完浏览器！
        <a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a>
    </div>
    <![endif]-->
    <!--baidu-->
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?65d9d9cb17716f625cef80c30abe65b4";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
        var root = "http://www.insgeek.com";
    </script>
    <!--baidu-->
    <!--GrowingIO 统计开始-->
    <script type='text/javascript'>
        var _vds = _vds || [] ;
        window._vds = _vds ;

        (function() {
            _vds.push( [ 'setAccountId', 'a91cb60d13f150c5' ] ) ;
            (function() {
                var vds = document.createElement( 'script' ) ;
                vds.type = 'text/javascript' ;
                vds.async = true ;
                vds.src = ( 'https:' == document.location.protocol ? 'https://' : 'http://' ) + 'dn-growing.qbox.me/vds.js' ;
                var s = document.getElementsByTagName( 'script' )[ 0 ] ;
                s.parentNode.insertBefore( vds, s ) ;
            })() ;
        })() ;
    </script>
    <!--GrowingIO 统计结束-->

</head>
<body class="top-navigation gray-bg">
<!--固定定位回到顶部-->

<div id="rightButton">
    <ul id="right_ul">
        <li id="right_online" class="right_ico" show="online" hide="tel" hide1="weixin"><a class="online_name" href="javascript:;" onclick="NTKF.im_openInPageChat('kf_9337_1467719589751')"></a></li>
        <li id="right_weixin" class="right_ico" show="weixin" hide="tel" hide1="online"></li>
        <li id="right_tel" class="right_ico" show="tel" hide="weixin" hide1="online"></li>
        <li id="right_tip" class="png">
            <p class="flag_online">工作日早8点 - 晚8点</p>
            <p class="flag_online"><button type="button" class="btn btn-xs btn-warning" onclick="NTKF.im_openInPageChat('kf_9337_1467719589751')" style="font-weight: 700">在线咨询</button></p>
            <p class="flag_weixin"></p>
            <p class="flag_tel" style="margin-top: 5px">工作日早8点 - 晚8点</p>
            <p class="flag_tel">400-886-2309</p>
        </li>
        <li><div id="backToTop"><a href="javascript:;" onfocus="this.blur();" class="backToTop_a png"></a></div></li>
    </ul>
</div>



<script type="text/javascript">
    $(document).ready(function(e) {
        $("#rightButton").css("right", "0px");
        var tip = 'url(http://www.insgeek.com/public/insgeek2.0/img/right-nav/bg_01.png) no-repeat';
        var erweima = 'url(http://www.insgeek.com/public/insgeek2.0/img/right-nav/erweima.png) no-repeat right';
        var button_toggle = true;
        $(".right_ico").on("mouseover", function(){
            var tip_top;
            var show= $(this).attr('show');
            var hide= $(this).attr('hide');
            var hide1= $(this).attr('hide1');
            if(show == 'online'){
                tip_top = -5;
                $("#right_tip").css("background" , tip);
            }else if(show == 'weixin'){
                tip_top = 0;
                $("#right_tip").css("background" , erweima).css("height" , 180);
            }else if(show == 'tel'){
                tip_top = 79;
                $("#right_tip").css("background" , tip);
            }
            button_toggle = false;
            $("#right_tip").css("top" , tip_top).show().find(".flag_"+show).show();
            $(".flag_"+hide).hide();
            $(".flag_"+hide1).hide();

        }).on("mouseout", function(){
            button_toggle = true;
            hideRightTip();
        });


        $("#right_tip").on("mouseover", function(){
            button_toggle = false;
            $(this).show();
        }).on("mouseout", function(){
            button_toggle = true;
            hideRightTip();
        });

        function hideRightTip(){
            setTimeout(function(){
                if( button_toggle ) $("#right_tip").hide();
            }, 500);
        }

        $("#backToTop").on("click", function(){
            var _this = $(this);
            $('html,body').animate({ scrollTop: 0 }, 500 ,function(){
                _this.hide();
            });
        });

        $(window).scroll(function(){
            var htmlTop = $(document).scrollTop();
            if( htmlTop > 0){
                $("#backToTop").fadeIn();
            }else{
                $("#backToTop").fadeOut();
            }
        });
    });
</script>
<script language="javascript" type="text/javascript">
    NTKF_PARAM = {
        siteid:"kf_9337",		            //企业ID，为固定值，必填
        settingid:"kf_9337_1467719589751",	//接待组ID，为固定值，必填
        uid:"61249",		                //用户ID，未登录可以为空，但不能给null，uid赋予的值显示到小能客户端上
        uname:"测试",		            //用户名，未登录可以为空，但不能给null，uname赋予的值显示到小能客户端上
        isvip:"0",                          //是否为vip用户，0代表非会员，1代表会员，取值显示到小能客户端上
        userlevel:"60",		        //网站自定义会员级别，0-N，可根据选择判断，取值显示到小能客户端上
        erpparam:"abc"                      //erpparam为erp功能的扩展字段，可选，购买erp功能后用于erp功能集成
    }
</script>
<!--回到顶部结束-->
<div id="wrapper">
    <div class="gray-bg" id="page-wrapper" style="padding: 0">
        <!--头部内容开始-->
        <div class="row nav-top">
            <div class="navy-bg">
                <div class="container">
                    <div class="pull-right">
                        <span class="pull-left text-white font-16" style="padding-right: 15px"><strong><i class="fa fa-phone"></i> 400-886-2309 </strong></span>
                        <ul class="pull-left head-erwei clearfix">
                            <li class="clearfix">
                                <span class="head-hover head-hover-zeo"></span>
                                <span class="head-hover-show">
                                    <span class="hover-top-triangle"></span>
                                    <span class="pec-box">
                                        <img src="http://www.insgeek.com/public/insgeek2.0/img/weixin_erweima.jpg" alt="微信二维码">
                                        <span class="remind-font">关注极客保公众号<br/>随身便携百保箱</span>
                                    </span>
                                </span>
                            </li>
                            <li class="clearfix">
                                <span class="head-hover head-hover-one"></span>
                                <span class="head-hover-show">
                                    <span class="hover-top-triangle"></span>
                                    <span class="pec-box">
                                        <img src="http://www.insgeek.com/public/insgeek2.0/img/sina_erweima.jpg" alt="微博二维码">
                                        <span class="remind-font">关注极客微博，简约<br/>文字，博览保险众生态</span>
                                    </span>
                                </span>
                            </li>
                            <li class="clearfix">
                                <span class="head-hover head-hover-two"></span>
                                <span class="head-hover-show">
                                    <span class="hover-top-triangle"></span>
                                    <span class="pec-box">
                                        <img src="http://www.insgeek.com/public/insgeek2.0/img/baoyan_erweima.jpg" alt="保研班二维码">
                                        <span class="remind-font">关注保研班<br/>洞悉风险，乐享保障</span>
                                    </span>
                                </span>
                            </li>
                        </ul>
                        <span id="login_reg" class="login">
                                 <a href="http://www.insgeek.com/group/index.html" >
									 									  <img src="http://www.insgeek.com/public/insgeek2.0/img/header/group.png" > 测试									 </a>
                                     <a data-toggle="modal" data-target="#personlAccount"><i class="fa fa-retweet"></i> 切换用户</a><div class="modal inmodal" id="personlAccount" tabindex="-1" role="dialog"  aria-hidden="true">
                                     <div class="modal-dialog login-modal-dialog">
                                         <div class="modal-content animated fadeIn">
                                             <div class="finance-recharge float-e-margins">
                                                 <div class="form-horizontal">
                                                     <div class="modal-header">
                                                         <button type="button" class="close" data-dismiss="modal">
                                                             <span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                                         <h3>账户切换</h3>
                                                         <small>请输入个人账户</small>
                                                     </div>
                                                     <div class="modal-body">
                                                         <form id="form_password"  name="form" action="http://www.insgeek.com/Login/logindo" method="post">
                                                             <div class="alert alert-danger alert-dismissable" style="display:none">
                                                                 <p class="small" id="errorMsgIDLogin">您输入用户名或密码错误.</p>
                                                             </div>
                                                             <div class="form-group">
                                                                 <label class="login-name control-label font-noraml">登录名称</label>
                                                                 <div class="login-input">
                                                                     <input name="user" id="userID" type="text" class="form-control bind-enter"
                                                                            placeholder="账号 / 手机号码 / 身份证">
                                                                 </div>
                                                             </div>
                                                             <div class="form-group">
                                                                 <label class="login-name control-label font-noraml">登录密码</label>
                                                                 <div class="login-input">
                                                                     <input name="password" id="passwordID" type="password" class="form-control bind-enter"
                                                                            placeholder="密码">
                                                                 </div>
                                                             </div>
                                                             <div class="form-group">
                                                                 <label class="login-name control-label font-noraml">验证码</label>
                                                                 <div class="login-input">
                                                                     <div id="drag-person" class="drag-public" style="width: 278px"></div>
                                                                 </div>
                                                             </div>
                                                             <input name="fromURL" type="hidden" value="" />
                                                             <input type="hidden" value="1" name="login_mode"/>
                                                             <div class="form-group" style="margin-bottom: 0">
                                                                 <div style="margin: 20px auto;width: 150px;">
                                                                     <button type="button" id="form_password_submit" class="btn btn-primary btn-block login-btn">登 录</button>
                                                                 </div>
                                                             </div>
                                                         </form>
                                                         <div class="text-center" style="font-size: 13px;color: #aaa;">若您忘记登录密码，请先登出当前<br/>账户，并在登录页进行密码找回</div>
                                                     </div>
                                                     <div class="modal-footer">
                                                         <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
                                                     </div>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                 </div>
                                                                  <a href="http://www.insgeek.com/login/logout"><span class="glyphicon glyphicon-log-out"></span> 退出</a>
                             </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row white-bg head-warp">
            <div class="container head">
                <a href="http://www.insgeek.com" class="pull-left">
                    <img src="http://www.insgeek.com/logo.png" alt="logo" title="保险极客"/>
                </a>
                <span style="float: left;height: 30px;line-height:30px;margin: 20px 0 20px 5px;font-size: 16px;color: #00ab9f;padding-left: 10px;border-left: 1px solid #00ab9f" title="中小企业员工保障">
                    中小企业员工保障
                </span>
                <!--新版导航设计-->
                <div class="nav-box" id="navbar" style="margin-right: -20px">
                    <ul>
                        <li id="index">
                            <a href="http://www.insgeek.com/"><span class="navbar-spacing">首</span>页</a>
                        </li>
                        <li id="insurancetemplate">
                            <a href="http://www.insgeek.com/InsuranceTemplate/index">产品中心</a>
                        </li>
                        <li id="user">
                            <a href="http://www.insgeek.com/user/insurance">保险管家</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="wrapper wrapper-content">
            <div class="container">
                <div class="row">
                    <div class="col-xs-2">
                        <div class="top-border white-bg">
                            <ul class="nav metismenu" id="side-menu">
                                <li id="index-group">
                                    <a href="http://www.insgeek.com/group/index">
                                        <i class="fa fa-home"></i><span class="nav-label">用户首页</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="fa fa-calendar-o"></i><span class="nav-label">保障管理</span>
                                        <span class="fa arrow"></span>
                                    </a>
                                    <ul class="nav left-m collapse">
                                        <li id="insurance">
                                            <a href="http://www.insgeek.com/group/insuranceList">
                                                <i class="fa fa-list-alt"></i>保障方案
                                            </a>
                                        </li>
                                        <li id="userlist">
                                            <a href="http://www.insgeek.com/group/userList">
                                                <i class="fa fa-sitemap"></i>成员管理
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="fa fa-pie-chart"></i><span class="nav-label">数据统计</span>
                                        <span class="fa arrow"></span>
                                    </a>
                                    <ul class="nav left-m collapse">
                                        <li id="lipei_s">
                                            <a href="http://www.insgeek.com/DataStatistics/lipei_statistical">
                                                <i class="fa fa-line-chart"></i>报销统计
                                            </a>
                                        </li>
                                        <li id="user_s">
                                            <a href="http://www.insgeek.com/DataStatistics/user_statistical">
                                                <i class="fa fa-area-chart"></i>人管统计
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="fa fa-calculator"></i><span class="nav-label">财务中心</span>
                                        <span class="fa arrow"></span>
                                    </a>
                                    <ul class="nav left-m nav-second-level collapse">
                                        <li id="financialIndex">
                                            <a href="http://www.insgeek.com/financial/index"><i class="fa fa-list"></i> 总览</a>
                                        </li>
                                        <li id="charge">
                                            <a href="http://www.insgeek.com/financial/charge"><i class="fa fa-money"></i> 充值</a>
                                        </li>
                                        <li id="payment">
                                            <a href="http://www.insgeek.com/financial/payment"><i class="fa fa-external-link"></i> 缴费</a>
                                        </li>
                                        <li id="withdraw">
                                            <a href="http://www.insgeek.com/financial/withdraw"><i class="fa fa-credit-card"></i> 提现</a>
                                        </li>
                                        <li id="manageInfo">
                                            <a href="http://www.insgeek.com/financial/manageInfo"><i class="fa fa-cogs"></i> 管理设置</a>
                                        </li>
                                        <li id="changeFinancialPassword" style="margin-bottom:0">
                                            <a href="http://www.insgeek.com/financial/changeFinancialPassword"><i class="fa fa-tasks"></i> 财务密码</a>
                                        </li>
                                    </ul>
                                </li>
                                <li id="updateGroupUserInfo">
                                    <a href="http://www.insgeek.com/group/updateGroupUserInfo">
                                        <i class="fa fa-cog"></i><span class="nav-label">账户维护</span>
                                    </a>
                                </li>
                                <li id="admin_log">
                                    <a href="http://www.insgeek.com/DataStatistics/admin_log">
                                        <i class="fa fa-pencil-square"></i><span class="nav-label">操作记录</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xs-10">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <form action="http://www.insgeek.com/Service/down_load_file" method="post">
                                    <input type="hidden" name="group_id" value="61249"/>
                                    <span>
					批量加人流程
					<a type="button" class="btn btn-primary btn-xs pull-right" href='flow_batch.html'>重新上传</a>
					<button type="submit" class="btn btn-primary btn-xs pull-right" style="margin-right: 20px">下载excel模板</button>
				</span>
                                </form>
                            </div>
                            <div class="ibox-content" id="loading">
                                <div class="spiner-example" style="height: 300px">
                                    <div class="loading" style="height: 200px"></div>
                                </div>
                            </div>
                            <!--连带被保险人显示模板 start-->
                            <!--连带被保险人显示模板 end-->


                            <!--医保信息模板 连带子女 start-->
                            <!--医保信息模板 连带子女 end-->

                            <!--医保信息模板 非连带子女 start-->
                            <div class="ibox-content">
                                <table class="table-bordered table-lian table-hover tooltip-demo">
                                    <thead>
                                    <tr>
                                        <th colspan="13" style="text-align: left;background: #ffffff;padding: 10px;font-size: 14px">
                                            本次批量上传人员共 <span class="text-info">1</span> 人，已上传人员信息错误为 <span class="table-error">1</span> 条
                                            <!--，总预计保费<span class="table-error">￥0</span>-->
                                            <div class="alert alert-danger text-center" style="display:none" id="verify_failID">
                                                <p id="max_person_error_msg"></p>
                                                <p id="avg_error_msg"></p>
                                            </div>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th style="width: 10%" class="text-center">序号</th>
                                        <th style="width: 15%">姓名<br />证件号码</th>
                                        <th style="width: 15%">手机号码</th>
                                        <th style="width: 20%;">医保信息</th>
                                        <th style="width: 20%">方案名称</th>
                                        <th style="width: 20%">保障期间</th>
                                        <!--<th style="width: 50px" class="text-center">预计保费</th>-->
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td class="text-center">
                                            <span data-toggle="tooltip" data-placement="top" class="table-error">1</span>                </td>
                                        <td>
                                            <p>
                                                老王                                                </p>
                                            <p style="margin-bottom: 0">
                                                411322198904092998                                                </p>
                                        </td>
                                        <td>
                                            <span data-toggle="tooltip" data-placement="top" data-original-title="手机格式错误" class="table-error">111111</span>                </td>
                                        <td>
                                            <p>不需要</p>                </td>
                                        <td>
                                            【极客保 - 意外型】测试                                        </td>
                                        <td>
                                            <p>
                                                <span class="label" style="padding: 3px">起</span>
                                                <span data-toggle="tooltip" data-placement="top" data-original-title="生效日期不在规定范围内" class="table-error">
                                                                            2017-01-01                                </span>                    </p>
                                            <p style="margin-bottom: 0">
                                                <span class="label" style="padding: 3px">止</span>
                                                <span>2017-08-08</span>
                                            </p>
                                        </td>
                                        <!--<td class="text-center">-->
                                        <!--￥-->
                                        <!--</td>-->
                                    </tr>        </tbody>
                                    <tfoot>
                                    <tr>
                                        <td colspan="13" style="color: #676a6c">
                                            注意： <span class="table-error">红色标示</span> 位置为错误信息，请再次核实上传内容，如有疑问请拨打客服电话：400-886-2309
                                        </td>
                                    </tr>
                                    </tfoot>
                                </table>
                                <div class="text-center" style="margin-top: 20px">
                                    <a href='flow_batch.html' class="btn btn-w-m btn-white">重新上传</a>
                                </div>
                            </div>        <!--医保信息模板 非连带子女 end-->


                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layer2 _loading" style=""></div>
        <div class="load _loading">
            <img src="http://www.insgeek.com/public/insgeek2.0/img/user/loading.gif">
            <p>提交中，请稍后！</p>
        </div>

        <!-- footer 开始 -->
        <div class="row foot-bar navy-bg">
            <div class="container">
                <div class="col-xs-8">
                    <div class="col-xs-4" onselectstart="return false;" unselectable="on">
                        <img class="bottom-erwei-pec" src="http://www.insgeek.com/public/insgeek2.0/img/foot-er.png">
                        <span class="bottom-erwei-font text-center">微信关注极客保</span>
                    </div>
                    <ul class="list-unstyled col-xs-2 foot-md text-center">
                        <h3>探索极客</h3>
                        <li><a href="http://www.insgeek.com/help/view/id/2" rel="nofollow">关于我们</a></li>
                        <li><a href="http://www.insgeek.com/help/view/id/7" rel="nofollow">极客团队</a></li>
                        <li><a href="http://www.insgeek.com/help/view/id/9" rel="nofollow">资质展示</a></li>
                        <li><a href="http://www.insgeek.com/help/view/id/11" rel="nofollow">联系我们</a></li>
                    </ul>
                    <ul class="list-unstyled col-xs-2 foot-md text-center">
                        <h3>享用极客</h3>
                        <li><a href="http://www.insgeek.com/help/view/id/13" rel="nofollow">企业员福</a></li>
                        <li><a href="http://www.insgeek.com/help/view/id/16" rel="nofollow">企业保障</a></li>
                        <li><a href="http://www.insgeek.com/help/view/id/18" rel="nofollow">个人服务</a></li>
                        <li><a href="http://www.insgeek.com/help/view/id/20" rel="nofollow">战略合作</a></li>
                    </ul>
                    <ul class="list-unstyled col-xs-2 foot-md text-center">
                        <h3>极客动态</h3>
                        <li><a href="http://www.insgeek.com/help/view/cid/7" rel="nofollow">媒体报道</a></li>
                        <li><a href="http://www.insgeek.com/help/view/cid/8" rel="nofollow">极客快讯</a></li>
                    </ul>
                    <ul class="list-unstyled col-xs-2 foot-md text-center">
                        <h3>极客帮助</h3>
                        <li><a href="http://www.insgeek.com/help/view/id/24" rel="nofollow">常见问题</a></li>
                        <li><a href="http://www.insgeek.com/help/view/id/26" target="_blank" rel="nofollow">服务协议</a></li>
                        <li><a href="http://www.insgeek.com/help/view/id/28" target="_blank" rel="nofollow">企业帮助</a></li>
                        <li><a href="http://www.insgeek.com/help/view/id/30" target="_blank" rel="nofollow">个人帮助</a></li>
                    </ul>
                </div>
                <div class="col-xs-4 text-center">
                    <p style="font-size: 34px;margin-bottom: 8px;"><i class="fa fa-phone"></i> 400-886-2309</p>
                    <p style="margin-bottom: 6px;"><a style="color: #fff" rel="nofollow" onclick="NTKF.im_openInPageChat('kf_9337_1467719589751')"><i class="fa fa-heart"></i> 在线客服
                            <script language="javascript" type="text/javascript">
                                NTKF_PARAM = {
                                    siteid:"kf_9337",		            //企业ID，为固定值，必填
                                    settingid:"kf_9337_1467719589751",	//接待组ID，为固定值，必填
                                    uid:"61249",		                //用户ID，未登录可以为空，但不能给null，uid赋予的值显示到小能客户端上
                                    uname:"测试",		    //用户名，未登录可以为空，但不能给null，uname赋予的值显示到小能客户端上
                                    isvip:"0",                          //是否为vip用户，0代表非会员，1代表会员，取值显示到小能客户端上
                                    userlevel:"60",		                //网站自定义会员级别，0-N，可根据选择判断，取值显示到小能客户端上
                                    erpparam:"abc"                      //erpparam为erp功能的扩展字段，可选，购买erp功能后用于erp功能集成
                                }
                            </script>
                            <script type="text/javascript" src="http://dl.ntalker.com/js/xn6/ntkfstat.js?siteid=kf_9337" charset="utf-8"></script>
                        </a>
                        <a  style="color: #fff" rel="nofollow" onclick="NTKF.im_openInPageChat('kf_9337_1467719589751')"><i class="fa fa-thumbs-up" style="padding-left: 75px"></i> 反馈建议
                            <script language="javascript" type="text/javascript">
                                NTKF_PARAM = {
                                    siteid:"kf_9337",		            //企业ID，为固定值，必填
                                    settingid:"kf_9337_1467719589751",	//接待组ID，为固定值，必填
                                    uid:"61249",		                //用户ID，未登录可以为空，但不能给null，uid赋予的值显示到小能客户端上
                                    uname:"测试",		    //用户名，未登录可以为空，但不能给null，uname赋予的值显示到小能客户端上
                                    isvip:"0",                          //是否为vip用户，0代表非会员，1代表会员，取值显示到小能客户端上
                                    userlevel:"60",		                //网站自定义会员级别，0-N，可根据选择判断，取值显示到小能客户端上
                                    erpparam:"abc"                      //erpparam为erp功能的扩展字段，可选，购买erp功能后用于erp功能集成
                                }
                            </script>
                            <script type="text/javascript" src="http://dl.ntalker.com/js/xn6/ntkfstat.js?siteid=kf_9337" charset="utf-8"></script>
                        </a></p>
                    <p style="margin-bottom: 6px;"><i class="fa fa-envelope-o"></i> 客服邮箱 service@insgeek.com</p>
                    <p style="margin-bottom: 6px;"><i class="fa fa-clock-o"></i> 工作时间 ( 工作日 08:00-20:00 ) </p>
                    <p style="text-align: left;padding-left: 54px;margin-bottom: 6px"><i class="fa fa-suitcase"></i> 商务合作 010-67029688</p>
                </div>
            </div>
        </div>
        <div class="row footer-bottom">
            <div class="container">
                <div class="ins-maindiv ins-center clearfix">
                    <div class="col-xs-12 text-center text-muted">
                        <small class="friendly-link">
                            <a href="http://www.ab-insurance.com/" target="_blank" rel="nofollow">安邦保险</a>
                            <a href="http://www.pingan.com" target="_blank" rel="nofollow">中国平安</a>
                            <a href="http://www.unionlife.com.cn/" target="_blank" rel="nofollow">合众人寿</a>
                            <a href="http://www.taikang.com/tkyl" target="_blank" rel="nofollow">泰康养老</a>
                            <a href="https://www.newchinalife.com" target="_blank" rel="nofollow">新华保险</a>
                            <a href="http://www.haodf.com" target="_blank" rel="nofollow">好大夫在线</a>
                            <a href="http://www.qinqinxiaobao.com" target="_blank" rel="nofollow">亲亲小保</a>
                            <a href="http://www.qiban.com/" target="_blank" rel="nofollow">企办</a>
                            <a href="https://qiye.xingyoucai.com/" target="_blank" rel="nofollow">中子星企明星</a>
                            <a href="https://www.evervc.com/" target="_blank" rel="nofollow">天天投</a>
                            <a href="https://www.daxiangrenshi.com/" target="_blank" rel="nofollow">大象人事</a>
                            <a href="http://www.xnaren.com/" target="_blank" rel="nofollow">纳人</a>
                        </small>
                    </div>
                    <div class="col-xs-12 text-center text-muted">
                        <p>
                            <small>
                                保险极客<a href="http://www.insgeek.com/">员工福利</a>产品&nbsp;© 2014-2016 Insgeek.com All Rights Reserved
                                <a href="http://www.miitbeian.gov.cn/publish/query/indexFirst.action" target="_blank" rel="nofollow">京ICP备15030724号 </a>
                            </small>
                            <br>
                            <small>
                                请使用IE9+/Chrome/Firefox/360急速模式，获得最佳浏览体验
                                <!--<a href="http://m.insgeek.com/UploadUserInfo/upload_sure">[ 移动端 ]</a>-->
                            </small>
                        </p>
                    </div>
                    <div class="col-xs-12 text-center">
                        <div class="photos">
                            <a href="http://www.insgeek.com">
                                <img src="http://www.insgeek.com/logo_a.png" alt="logo" title="保险极客"/>
                            </a>
                            <a id='___szfw_logo___' href='https://credit.szfw.org/CX20150928011852880188.html' target='_blank'><img src='http://icon.szfw.org/cert.png' border='0' width="90" height="33"/></a>
                            <script type='text/javascript'>(function(){document.getElementById('___szfw_logo___').oncontextmenu = function(){return false;}})();</script>
                            <a href='https://ss.knet.cn/verifyseal.dll?sn=e15072711010859602eeyb000000&a=1&pa=0.06950726862664514' target='_blank'  rel="nofollow"><img src='http://www.insgeek.com/public/insgeek2.0/img/knet_logo.png' border='0'/></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- footer 结束 -->
    </div>
</div>

<!--vuejs-->
<script src="http://www.insgeek.com/public/insgeek2.0/js/vuejs/vue.js"></script>
<script src="http://www.insgeek.com/public/insgeek2.0/js/ig_common.js"></script>
<!-- Data Tables -->
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/dataTables/dataTables.bootstrap.js"></script>

<!-- iCheck -->
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/iCheck/icheck.min.js"></script>
<!-- 时间组件 -->
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/datapicker/bootstrap-datepicker.js"></script>

<!-- Sweet alert -->
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/sweetalert/sweetalert.min.js"></script>
<!-- 图片浏览 -->
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/blueimp/jquery.blueimp-gallery.min.js"></script>
<!-- 流程组件 -->
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/staps/jquery.steps.min.js"></script>
<!-- FooTable -->
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/footable/footable.all.min.js"></script>
<!-- Custom and plugin javascript -->
<script src="http://www.insgeek.com/public/insgeek2.0/js/inspinia.js"></script>
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/pace/pace.min.js"></script>
<!-- Page-Level Scripts -->
<!--slick-->
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/slick/slick.min.js"></script>
<!--drag-->
<script src="http://www.insgeek.com/public/insgeek2.0/js/plugins/drag/drag.js"></script>
<script type="text/javascript">
    $(function () {
        var page= "#"+ $("#page").attr("data-page");
        $(page).addClass("active");
        $(page).parent().addClass("in");
        $(page).parent().parent().addClass("active");
        //alert(page);
        $('.date').datepicker({
            format: 'yyyy-mm-dd',
            keyboardNavigation: false,
            forceParse: false,
            autoclose: true
            //todayBtn: 'linked'
        });
    });
</script>
</body>
</html>
<script>
    function loading (status) {
        eval("$('._loading')." + status + '()');
    }
    $(document).ready(function ()
    {
        var displayMode="medicare";
        var maxNumStatus=$.parseJSON('[]');
        var is_upload_err = true;
        var currectUserJson = "";
        var passUserCount = 0;
        var avg_error_obj = $("#verify_failID #avg_error_msg");
        var max_person_error_obj = $("#verify_failID #max_person_error_msg");
        var directErrorObj = $("#directError");
        var $userCount = $( '.userCount' );
        var $errorUserCount = $( '.errorUserCount' );
        if(displayMode=='error'||displayMode=='direct'||displayMode=='family' || displayMode == 'medicare' || displayMode == 'medicare_children')
        {
            if(!initUploadUsres()){
                directErrorObj.removeClass("alert-success");
                directErrorObj.addClass("alert-danger");
            }
            return;
        }
        var root="http://www.insgeek.com";
        var group_id=$.trim($('#group_id').val());
        var flag="Array";
        var userNum=0;
        if (flag==false)
        {
            userNum=0;
        }
        else
        {
            userNum=parseInt("1");
        }
        var removeCounter=0;
        var all_ids=new Array(userNum);
        var all_mobiles=new Array(userNum);
        var all_plans=new Array();
        var groupIns=$.parseJSON('');
        var allowDays=new Array();
        var allowdDaysSub=new Array();
        var startDatePickerObj = new Array(userNum);
        var endDatePickerObj = new Array(userNum);
        allowdDaysSub['range_startDate']=0;
        allowdDaysSub['range_endDate']=0;
        allowDays["0"]=allowdDaysSub;

        for(var i=0;i<groupIns.length;i++)
        {
            var tmp=groupIns[i];
            var allowdDaysSub=new Array();
            allowdDaysSub['range_startDate']=tmp.range_startDate;
            allowdDaysSub['range_endDate']=tmp.range_endDate;
            allowDays[groupIns[i]['eid']]=allowdDaysSub;
        }


        /*初始化批量上传人员信息*/
        function initUploadUsres(){
            var directMaxPersonErrorObj = $("#directMaxPersonError");
            var directAvgErrorObj = $("#directAvgError");
            var uploadDirectBtnID = $("#uploadDirectBtnID");
            //显示方案最大年龄的错误信息
            if(maxNumStatus.length != 0){
                var maxPersonMsg = '';
                $.each(maxNumStatus,function(k,v){
                    maxPersonMsg += (v.insurance + v.msg + '<br />');
                });
                is_upload_err = false;
                max_person_error_obj.html(maxPersonMsg);
                directMaxPersonErrorObj.html(maxPersonMsg);
            }
            //显示方案平均年龄的错误信息
//            var avgErrorMsg = "很抱歉，待添加的人员将使方案的平均年龄超出限制，请再次确认信息。";
            var avgErrorMsg = '';
            var avgFlag = $.parseJSON('null');
            var avgIsSuccess = true;
            if(avgFlag != null){
                $.each(avgFlag,function(k,v){
                    if(!v.result){
                        avgErrorMsg += "方案《"+v.insurance_name+"》平均年龄受限制(平均年龄应为 "+v.db_avg_age+" 实际平均年龄为 "+v.avg_age+"；信息错误的人员年龄除外)<br />";
                        is_upload_err = false;
                        avgIsSuccess = false;
                    }
                });

                if(!avgIsSuccess){
                    avg_error_obj.html(avgErrorMsg);
                    directAvgErrorObj.html(avgErrorMsg);
                }
//                avgErrorMsg = avgErrorMsg.replace(/(\s*,$)/g,"");
//                avgErrorMsg+=" 成员平均年龄受限制";
                if(!is_upload_err){
                    uploadDirectBtnID.prop('disabled', true);
                    $('#upload_sureID').prop('disabled', true);
                    $("#verify_passID").hide();
                    $("#verify_failID").show();
                }
                //获取验证成功者的json数组
                if('medicare' == 'modify' || 'medicare' == 'direct'){
                    currectUserJson = '';
                    passUserCount = JSON.parse(currectUserJson).length;
                }
            }

            return is_upload_err;
        }
        initUploadUsres();
        /*所有方案允许选择的时间*/
        $("#batch_insuranceID option").each(function (index)
        {
            all_plans[index]=$.trim($(this).val());
        });
        $("input[name='data[id_number][]']").each(function (index)
        {
            all_ids[index]=$.trim($(this).val());
        });
        $("input[name='data[mobile][]']").each(function (index)
        {
            all_mobiles[index]=$.trim($(this).val());
        });

        function getAgeModeByEid(eid){
            var age_check_mode = '';
            $.each(groupIns,function(k,v){
                if(eid == v.eid){
                    age_check_mode = v.age_check_mode;
                    return false;
                }
            });
            if(age_check_mode != ''){
                return age_check_mode;
            }else{
                return false;
            }
        }

        function is_check_single_age(eid){
            var age_mode = getAgeModeByEid(eid);
            if(age_mode != 21 && age_mode != 22 && age_mode != 23){
                return true;
            } else {
                return false;
            }
        }
        var all_names_flag=new Array(userNum);
        var all_id_flag=new Array(userNum);
        var all_mobile_flag=new Array(userNum);
        var all_date_flag=new Array(userNum);
        var all_end_date_flag=new Array(userNum);
        var all_insurance_flag=new Array(userNum);
        var all_age_flag = new Array(userNum);
        //设定日期范围
        function setDate(obj, startDate, endDate, defaultDate)
        {
            if(startDate == 0){
                startDate = '-'+ startDate +'d';
            }
            if(endDate == 0){
                endDate = '-'+ endDate +'d';
            }
            obj.datepicker("setStartDate", startDate);
            obj.datepicker("setEndDate", endDate);
            if (defaultDate)
            {
//                obj.datepicker("setDate", defaultDate);
                obj.find('input').val(defaultDate);
            }
        }

        function initDatePicker(obj,index,isStart){
            obj=obj.find('.input-group');

            var tmpObj = obj.datepicker({
                format: 'yyyy-mm-dd',
                keyboardNavigation: false,
                forceParse: false,
                autoclose: true
//                startDate: startDate,
//                endDate: endDate
            }).on('changeDate', function(event){
                if(isInsuranceChange){
                    if($(this).data('target') == 'startDate'){
                        changeStartDate($(this).find('input'));
                    }else{
                        changeEndDate($(this).find('input'));
                    }
                }
            });

            if(isStart){
                startDatePickerObj[index] = tmpObj;
            }else{
                endDatePickerObj[index] = tmpObj;
            }
        }

        /*检查用户名（格式和是否与预留的一致）*/
        function check_realname_in_page(realnameObj, index)
        {
            var realname=$.trim(realnameObj.val());
            if (check_realname_format(realname)==1)
            {
                realnameObj.removeClass('error');
                all_names_flag[index]=true;
            }
            else
            {
                realnameObj.addClass('error');
                all_names_flag[index]=false;
                return;
            }
            /*获得当前行的id_number*/
            var curIdObj=realnameObj.parent().next().find('#id_numberID');
            var cur_id=$.trim(curIdObj.val());
            if (check_realname_match_db_ajax(realname, cur_id, root)==1)
            {
                realnameObj.removeClass('error').attr('title', "");
                all_names_flag[index]=true;
            }
            else
            {
                realnameObj.attr('title', "真实姓名与该身份证预留的姓名不一致").addClass('error');
                all_names_flag[index]=false;
            }
        }

        /*检查手机号（格式-可以为空，是否重复）*/
        function check_mobile_in_page(mobileObj, index)
        {
            var mobile=$.trim(mobileObj.val());
            if ($.inArray(mobile, all_mobiles)== -1)
            {
                all_mobiles[index]=mobile;
            }
            if (check_mobile_format(mobile, true)==1)
            {
                mobileObj.removeClass('error');
                all_mobile_flag[index]=true;
            }
            else
            {
                mobileObj.addClass('error');
                all_mobile_flag[index]=false;
                return;
            }
        }

        /*检查开始日期（格式和区间）*/
        function check_starttime_in_page(eid, starttimeObj,index)
        {
            var date=$.trim(starttimeObj.val());
            if (check_date_formate(date))
            {
                if (check_starttime_in_range(date, eid, group_id, root))
                {
                    starttimeObj.removeClass('error').attr('title', "");
                    all_date_flag[index]=true;
                }
                else
                {
                    starttimeObj.addClass('error').attr('title', "生效日期不在规定范围内");
                    all_date_flag[index]=false;
                }
            }
            else
            {
                starttimeObj.addClass('error').attr('title', "生效日期格式错误");
                all_date_flag[index]=false;
            }
        }

        /*检查结束日期（格式和区间）*/
        function check_endtime_in_page(eid, endtimeObj, index)
        {
            var date=$.trim(endtimeObj.val());
            if (check_date_formate(date))
            {
                //再检查结束时间是否满足要求：晚于开始日期，早于方案的结束日期
                //取得该人的开始日期
                var starttime=$.trim(endtimeObj.parent().parent().siblings().find('input[name="data[starttime][]"]').val());
                if (check_endtime_in_range(date, starttime, group_id, eid, root))
                {
                    endtimeObj.removeClass('error').attr('title', "");
                    all_end_date_flag[index]=true;
                }
                else
                {
                    endtimeObj.addClass('error').attr('title', "失效日期不在规定范围内");
                    all_end_date_flag[index]=false;
                }
            }
            else
            {
                endtimeObj.addClass('error').attr('title', "失效日期格式错误");
                all_end_date_flag[index]=false;
            }
        }

        //遍历所有姓名
        var all_names=new Array(userNum);
        $("input[name='data[realname][]']").each(function (index)
        {
            all_names[index]= $.trim($(this).val());
            if ($(this).hasClass('error'))
            {
                all_names_flag[index]=false;
            }
            else
            {
                all_names_flag[index]=true;
            }
            $(this).on('blur', function ()
            {
                if($.trim($(this).val())!=all_names[index]){
                    index=$(this).parent().parent().index();
                    check_realname_in_page($(this), index);
                    updateWarning();
                }
            });
        });
        //遍历所有mobile
        $("input[name='data[mobile][]']").each(function (index)
        {
            if ($(this).hasClass('error'))
            {
                all_mobile_flag[index]=false;
            }
            else
            {
                all_mobile_flag[index]=true;
            }
            $(this).on('blur', function ()
            {
                if($.trim($(this).val())!=all_mobiles[index]){
                    index=$(this).parent().parent().index();
                    check_mobile_in_page($(this), index);
                    updateWarning();
                }
            });
        });
        //设置每个人的方案初始值（从excel读取的）
        $("select[name='data[insurance][]']").each(function (index)
        {
            var input_insuranceObj = $(this).next("#input_insuranceID");
            var input_insurance = $.trim(input_insuranceObj.val());
            $(this).val(input_insurance);
            if ($(this).hasClass('error'))
            {
                all_insurance_flag[index]=false;
            }
            else
            {
                all_insurance_flag[index]=true;
            }
        });
        //遍历所有id_number
//       function Ergodic(){
        var insuranceRule = parseInt('0');
        $("input[name='data[id_number][]']").each(function (index)
        {
            if ($(this).hasClass('error'))
            {
                if($(this).attr('age_flag') == 'true'){
                    all_age_flag[index]=false;
                    all_id_flag[index]=true;
                }else{
                    all_id_flag[index]=false;
                }
            }
            else
            {
                all_id_flag[index]=true;
                all_age_flag[index]=true;
            }
            $(this).on('blur', function ()
            {
//                if($.trim($(this).val())!=all_ids[index]){
                var id=$.trim($(this).val());
                index=$(this).parent().parent().index();
                var realnameObj=$(this).parent().siblings().find("input[name='data[realname][]']");
                var mobileObj=$(this).parent().siblings().find("input[name='data[mobile][]']");
                var starttime=$(this).parent().siblings().find("input[name='data[starttime][]']");
                var insurance=$(this).parent().siblings().find("select[name='data[insurance][]']");
                all_ids[index]=id;
                if (check_id_number_format(id))
                {
                    if(checkBirthLt28d(id.substring(6,14), starttime.val())){
                        $(this).addClass('error').attr('title', '很抱歉，被保险人未满28天，不能投保。');
                        all_id_flag[index]=false;
                    }
                    else if (check_value_repeat_in_array(id, all_ids, all_eids[index], all_eids, insuranceRule).length>1)
                    {
                        $(this).addClass('error').attr('title', insuranceRule?'该身份证在当前选择方案下有重复':'与他人的身份证号码重复');
                        all_id_flag[index]=false;
                    }
                    else
                    {
                        check_realname_in_page(realnameObj, index);
                        check_mobile_in_page(mobileObj, index);
                        $(this).removeClass('error').attr('title', "");
                        all_id_flag[index]=true;
                        var tmpResult=check_user_has_valid_insurance_ajax(all_eids[index], id, group_id, root);
                        if (!tmpResult['pass'])
                        {
                            insurance.addClass('error').attr('title', tmpResult['msg']);
                            all_insurance_flag[index]=false;
                        }
                        else
                        {
                            if(insurance.val()!='无效方案'){
                                insurance.removeClass('error').attr('title', '');
                                all_insurance_flag[index]=true;
                            }
                        }
                        //判断更改方案的年龄范围
                        var this_obj=$(this);
                        if(all_date_flag[index] && all_insurance_flag[index] && all_id_flag[index] && is_check_single_age($.trim(insurance.val()))){
                            var check_single_age = {};
                            check_single_age.eid = $.trim(insurance.val());
                            check_single_age.starttime = $.trim(starttime.val());
                            check_single_age.birth = id.substring(6,14);
                            callAjax({ "single_user_info": JSON.stringify(check_single_age), "group_id": group_id }, 0, function (response)
                            {
                                if(response == null){
                                    swal('您的信息有误！！','','warning');
                                    all_age_flag[index] = false;
                                }
                                else if (response.result)
                                {
                                    //正确
                                    this_obj.attr('title', "").removeClass('error');
                                    all_age_flag[index]=true;
                                } else
                                {
                                    this_obj.attr('title', response.msg).addClass('error');
                                    all_age_flag[index] = false;
                                }
                            }, 'http://www.insgeek.com/check/check_batch_age_match_ajax/');
                        }
                    }
                }
                else
                {
                    $(this).addClass('error').attr('title', "证件号码不符合校验规则，请重新输入");
                    all_id_flag[index]=false;
                }
                updateWarning();
//                }
            });
        });
//       }
        function checkBirthLt28d(birth,starttime){
            var lt = 28 * 24 * 60 * 60;
            var ba = birth.split('');
            var sta = starttime.split('-');
            var bt = new Date(ba[0]+ba[1]+ba[2]+ba[3],parseInt(ba[4]+ba[5])-1,ba[6]+ba[7],0,0,0).getTime()/1000;
            var nt = new Date(sta[0],parseInt(sta[1])-1,sta[2],0,0,0).getTime()/1000 - lt;

            if(bt > nt) {
                return true;
            } else {
                return false;
            }

        }
        //更新时方案选择时候
        var isInsuranceChange = true;
        var all_eids = [];
        $("select[name='data[insurance][]']").each(function (index)
        {

            var starttimeObj=$(this).parent().siblings().find("input[name='data[starttime][]']");
            var endtimeObj=$(this).parent().siblings().find("input[name='data[endtime][]']");
            initDatePicker(starttimeObj.parent().parent(),index,true);
            initDatePicker(endtimeObj.parent().parent(),index,false);
            all_eids.push($(this).val());
            $(this).on('change', function ()
            {
                isInsuranceChange = false;
                var eid=$.trim($(this).val());
                all_eids[index]=eid;
                index=$(this).parent().parent().index();
                var id_number_obj=$(this).parent().parent().find("input[name='data[id_number][]']");
                var starttime_obj=$(this).parent().parent().find("input[name='data[starttime][]']");
                var id_number=$.trim(id_number_obj.val());
                var starttime = $.trim(starttime_obj.val());
//                var starttimeObj=$(this).parent().siblings().find("input[name='data[starttime][]']");
//                var endtimeObj=$(this).parent().siblings().find("input[name='data[endtime][]']");
                //设置日期控件
                setDatePicker(startDatePickerObj[index], eid, $.trim(starttimeObj.val()), allowDays);
                setDatePicker(endDatePickerObj[index], eid, $.trim(endtimeObj.val()), allowDays);
                check_starttime_in_page(eid, starttimeObj,index);
                check_endtime_in_page(eid, endtimeObj, index);
                if (eid!='0' && eid!='')
                {
                    $(this).removeClass('error').attr('title', "");
                    all_insurance_flag[index]=true;
                    if(all_date_flag[index] && all_id_flag[index] && is_check_single_age(eid)){
                        var check_single_age = {};
                        check_single_age.eid = eid;
                        check_single_age.starttime = starttime;
                        check_single_age.birth = id_number.substring(6,14);
                        if(check_value_repeat_in_array(id_number, all_ids, all_eids[index], all_eids, insuranceRule).length>1){
                            id_number_obj.attr('title', insuranceRule?'该身份证在当前选择方案下有重复':'与他人的身份证号码重复').addClass('error');
                            all_age_flag[index]=false;
                        }else {
                            var tmpResult=check_user_has_valid_insurance_ajax(eid, id_number, group_id, root);
                            if(!tmpResult['pass']){
                                $(this).addClass('error').attr('title', '用户已经加入了该保障方案');
                                all_insurance_flag[index]=false;
                            }else{
                                $(this).removeClass('error').attr('title', '');
                                all_insurance_flag[index]=true;
                                callAjax({ "single_user_info": JSON.stringify(check_single_age), "group_id": group_id }, 0, function (response)
                                {
                                    if(response == null){
                                        swal('您的信息有误！！','','warning');
                                        all_age_flag[index] = false;
                                    }
                                    else if (response.result)
                                    {
                                        //正确
                                        id_number_obj.attr('title', "").removeClass('error');
                                        all_age_flag[index]=true;
                                    } else
                                    {
                                        id_number_obj.attr('title', response.msg).addClass('error');
                                        all_age_flag[index] = false;
                                    }
                                }, 'http://www.insgeek.com/check/check_batch_age_match_ajax/');
                            }
                        }
                    }else{
                        if(all_id_flag[index]){
                            id_number_obj.attr('title', "").removeClass('error');
                            all_age_flag[index]=true;
                        }
                    }
                }
                else
                {
                    $(this).addClass('error').attr('title', "该方案不存在");
                    all_insurance_flag[index]=false;
                }
                updateWarning();
                isInsuranceChange = true;
            });
        });
        //遍历所有开始时间
        $("input[name='data[starttime][]']").each(function (index)
        {
            if ($(this).hasClass('error'))
            {
                all_date_flag[index]=false;
            }
            else
            {
                all_date_flag[index]=true;
            }
            var dateObj=$(this).parent().parent();
            var date=$.trim($(this).val());
            var insurance_name=$.trim(dateObj.siblings().find('select[name="data[insurance][]"]').val());
            setDatePicker(startDatePickerObj[index], insurance_name, date, allowDays);
        });

        function changeStartDate(obj){
            var index=obj.parent().parent().parent().index();
            var eid=obj.parent().parent().siblings().find('select[name="data[insurance][]"]');
            var id_number_obj=obj.parent().parent().siblings().find('input[name="data[id_number][]"]');
            var id_number = $.trim(id_number_obj.val());
            eid=$.trim(eid.val());
            check_starttime_in_page(eid,obj,index);
            var starttime = $.trim(obj.val());
            var endtimeObj=obj.parent().parent().siblings().find("input[name='data[endtime][]']");
            check_endtime_in_page(eid,endtimeObj, index);

            if(all_date_flag[index] && all_insurance_flag[index] && all_id_flag[index] && is_check_single_age(eid)){
                var check_single_age = {};
                check_single_age.eid = eid;
                check_single_age.starttime = starttime;
                check_single_age.birth = id_number.substring(6,14);
                callAjax({ "single_user_info": JSON.stringify(check_single_age), "group_id": group_id }, 0, function (response)
                {
                    if(response == null){
                        swal('您的信息有误！！','','warning');
                        all_age_flag[index] = false;
                    }
                    else if (response.result)
                    {
                        //正确
                        id_number_obj.attr('title', "").removeClass('error');
                        all_age_flag[index]=true;
                    } else
                    {
                        id_number_obj.attr('title', response.msg).addClass('error');
                        all_age_flag[index] = false;
                    }
                }, 'http://www.insgeek.com/check/check_batch_age_match_ajax/');
            }
            updateWarning();
        }
        /*根据日期控件和方案名设置Date Picker控件*/
        function setDatePicker(dateObj, eid, defaultDate, insuranceInfos)
        {
            if(insuranceInfos[eid]==null)
            {
                setDate(dateObj, 0,0, defaultDate);
            }
            else
            {
                setDate(dateObj, insuranceInfos[eid]['range_startDate'], insuranceInfos[eid]['range_endDate'], defaultDate);
            }
        }

        //遍历所有结束时间
        $("input[name='data[endtime][]']").each(function (index)
        {
            if ($(this).hasClass('error'))
            {
                all_end_date_flag[index]=false;
            }
            else
            {
                all_end_date_flag[index]=true;
            }
            var dateObj=$(this).parent().parent();
            var date=$.trim($(this).val());
            var insurance_name=$.trim(dateObj.siblings().find('select[name="data[insurance][]"]').val());
            setDatePicker(endDatePickerObj[index], insurance_name, date, allowDays);
        });


        function changeEndDate(obj){
            var index=obj.parent().parent().parent().index();
            var eid=obj.parent().parent().siblings().find('select[name="data[insurance][]"]');
            eid=$.trim(eid.val());
            check_endtime_in_page(eid,obj, index);
            updateWarning();
        }
        updateWarning();
        is_upload_err = true;

        function check_can_submit()
        {
            if (userNum<=0)
            {
                return !(displayMode=='modify');
            }
            var errorUserCount = 0;
            for (var i=0; i<userNum; i++)
            {
                if (all_age_flag[i]==false || all_names_flag[i]==false || all_id_flag[i]==false || all_mobile_flag[i]==false || all_date_flag[i]==false || all_insurance_flag[i]==false || all_end_date_flag[i]==false)
                {
                    errorUserCount++;
                }
            }
            return errorUserCount;
        }

        /*根据index来检查一个用户的各个flag是否通过*/
        function check_user_flag(index)
        {
            if (all_names_flag[index]==false || all_id_flag[index]==false || all_mobile_flag[index]==false || all_date_flag[index]==false || all_insurance_flag[index]==false)
            {
                return false;
            }
            else
            {
                return true;
            }
        }
        /*验证最大人数*/
        /*        if(maxNumStatus!=null&&maxNumStatus.length!=0)
         {
         var failObj=$("#verify_otherID");
         var msg='';
         for(var i=0;i<maxNumStatus.length;i++)
         {
         var insuranceName=getInsuranceNameByEid(maxNumStatus[i]['eid']);
         msg+="保障方案 ["+insuranceName+"]: "+maxNumStatus[i]['msg']+"。请调整参加保障方案的人员<br/>";
         }
         failObj.show().html(msg);
         $('#verify_passID').hide();
         }*/
        $('#upload_sureID').on('click', function ()
        {
            if (!check_can_submit())
            {
                if(check_avg_max_person()){
                    loading('show');
                    $(this).prop('disabled',true).text('正在上传，请稍后');
                    $('#userInfoFormID').submit();

                }
            }
            else
            {
                alert('请检查用户信息');
            }
        });
        function check_avg_max_person(){
            var globalMsg = '';
            var avg_age_info = checkUserInfoIsValid();
            var max_person_info = checkMaxPersonInfo();

            if(avg_age_info != true){
                globalMsg += avg_age_info;
                avg_error_obj.html(avg_age_info);
            }

            if(max_person_info != true){
                globalMsg += "\n" + max_person_info;
                max_person_error_obj.html(max_person_info);
            }

            if(avg_age_info == true && max_person_info == true){
                return true;
            }else{
                swal("错误！", globalMsg, "error");
                return false;
            }
        }

        function checkUserInfoIsValid(){
            var editbaleUser = getEditableUserInfo();
            mergeUserInfoArray(editbaleUser);
            //ajax提交到后台进行数据校验
            var ajaxFlag = true;
//            var avgErrorMsg = "很抱歉，待添加的人员将使方案的平均年龄超出限制，请再次确认信息。\n";
            var avgErrorMsg = "";
            callAjax({ "all_user_info": JSON.stringify(editbaleUser), "group_id": group_id}, 0, function (response)
            {
                if(response == null){
                    avgErrorMsg = '方案平均年龄信息有误！！';
                    ajaxFlag = false;
                }
                else {
                    $.each(response,function(k,v){
                        if(!v.result){
                            avgErrorMsg += "方案《"+v.insurance_name+"》平均年龄受限制(平均年龄应为 "+v.db_avg_age+" 实际平均年龄为 "+v.avg_age+"；信息错误的人员年龄除外)\n";
                            //                        is_vaild_avg_age = false;
                            ajaxFlag = false;
                        }
                    });
                }
                avgErrorMsg = avgErrorMsg.replace(/(\s*,$)/g,"");
            }, 'http://www.insgeek.com/check/check_batch_age_match_ajax/');
            return ajaxFlag?true:avgErrorMsg;
        }
        function checkMaxPersonInfo(){
            var editbaleUser = getEditableUserInfo();
            mergeUserInfoArray(editbaleUser);
            //ajax提交到后台进行数据校验
            var ajaxFlag = true;
            var maxPersonErrorMsg = '';
            callAjax({ "all_user_info": JSON.stringify(editbaleUser), "group_id": group_id}, 0, function (response)
            {
                if(response == null){
                    maxPersonErrorMsg = '方案最大人数信息有误！！';
                    ajaxFlag = false;
                }else if(response.length != 0){
                    $.each(response,function(k,v){
                        maxPersonErrorMsg += (v.insurance + v.msg + '\n');
                    });
                    ajaxFlag = false;
                }
            }, 'http://www.insgeek.com/check/check_max_person_limit_ajax/');
            return ajaxFlag?true:maxPersonErrorMsg;
        }
        function mergeUserInfoArray(editbaleUser){
            if(currectUserJson != ''){
                $.each($.parseJSON(currectUserJson),function(k,v){
                    var item = {};
                    item.realname = v.realname;
                    item.birth = (v.id_number).substring(6,14);
                    item.mobile = v.mobile;
                    item.eid = v.eid;
                    item.insurance = v.insurance;
                    item.starttime = v.starttime;
                    item.endtime = v.endtime;
                    editbaleUser.push(item);
                });
            }
        }
        function getEditableUserInfo(){
            var realname_input = $("#user_tableID tbody tr input[name='data[realname][]']");
            var id_number_input = $("#user_tableID tbody tr input[name='data[id_number][]']");
            var mobile_input = $("#user_tableID tbody tr input[name='data[mobile][]']");
            var insurance_select = $("#user_tableID tbody tr select[name='data[insurance][]']");
            var starttime_input = $("#user_tableID tbody tr input[name='data[starttime][]']");
            var endttime_input = $("#user_tableID tbody tr input[name='data[endtime][]']");
            var editableUserInfo = [];
            $.each(realname_input,function(k,v){
                var userItem = {};
                userItem.realname = $.trim(realname_input.eq(k).val());
                userItem.birth = $.trim(id_number_input.eq(k).val()).substring(6,14);
                userItem.mobile = $.trim(mobile_input.eq(k).val());
                userItem.eid = $.trim(insurance_select.eq(k).val());
                userItem.insurance = $.trim(insurance_select.eq(k).find("option:selected").text());
                userItem.starttime = $.trim(starttime_input.eq(k).val());
                userItem.endtime = $.trim(endttime_input.eq(k).val());
                editableUserInfo.push(userItem);
            });
            return editableUserInfo;
        }
        function DelUserFlagsArray(index)
        {
            all_names_flag.splice(index, 1);
            all_id_flag.splice(index, 1);
            all_mobile_flag.splice(index, 1);
            all_date_flag.splice(index, 1);
            all_end_date_flag.splice(index, 1);
            all_insurance_flag.splice(index, 1);
            all_ids.splice(index, 1);
            all_age_flag.splice(index, 1);
            all_mobiles.splice(index, 1);
            startDatePickerObj.splice(index, 1);
            endDatePickerObj.splice(index, 1);
        }

        $('.del_single_user').click(function ()
        {
            var delBtn=$(this);
            swal({
                title: '您确定要删除此人吗？',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#DD6B55',
                confirmButtonText: '确认删除',
                cancelButtonText: '取消删除',
                closeOnConfirm: false
            }, function (isConfirm)
            {
                if (isConfirm)
                {
                    var trObj=delBtn.parent().parent();
                    var index=trObj.index();
                    DelUserFlagsArray(index);
                    trObj.remove();
                    removeCounter++;
                    userNum--;
                    swal('删除成功!', '', 'success');
                    updateWarning();
                }
                else
                {
                }
            });
        });
        /*获得全部被选中的user，返回index（array）*/
        function get_all_selected_user()
        {
            var checkArr=new Array();
            var count=0;
            $("#user_tableID tbody>tr").each(function (index)
            {
                var checkObj=$(this).find('#singleUserCheckID');
                if (checkObj.prop('checked'))
                {
                    checkArr[count]=index;
                    count++;
                }
            });
            return checkArr;
        }

        /*全选和非全选的切换*/
        $('#all_checkID').on('click', function ()
        {
            var allCheckObj=$(this);
            $("#user_tableID tbody>tr").each(function (index)
            {
                var checkObj=$(this).find('#singleUserCheckID');
                checkObj.prop('checked', allCheckObj.prop('checked'));
            });
        });
        $('.del_batch_user').click(function ()
        {
            var allUser=get_all_selected_user();
            if (!allUser.length>0)
            {
                return;
            }
            swal({
                title: '您确定要删除选中的人员吗？',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#DD6B55',
                confirmButtonText: '确认删除',
                cancelButtonText: '取消删除',
                closeOnConfirm: false
            }, function (isConfirm)
            {
                if (isConfirm)
                {
                    var tmpCount=0;
                    $("#user_tableID tbody>tr").each(function (index)
                    {
                        var checkObj=$(this).find('#singleUserCheckID');
                        if (checkObj.prop('checked'))
                        {
                            $(this).remove();
                            index=index - tmpCount;
                            DelUserFlagsArray(index);
                            removeCounter++;
                            tmpCount++;
                            userNum--;
                        }
                    });
                    swal('删除成功!', '您成功删除了选中成员', 'success');
                    updateWarning();
                }
                else
                {
                }
            });
        });
        /*批量更新保障方案*/
        $('#update_batchID').click(function ()
        {
            var allUser=get_all_selected_user();
            if (!allUser.length>0)
            {
                return;
            }
            var toUpdate=$.trim($('#batch_insuranceID').val());
            /*获得每一行用户*/
            $("#user_tableID tbody>tr").each(function (index)
            {
                var checkboxObj=$(this).find('#singleUserCheckID');
                if (checkboxObj.prop('checked'))
                {
                    var checkObj=$(this).find('#select_insuranceID');
                    checkObj.val(toUpdate).change();
                }
            });
        });

        function updateWarning()
        {
            var passObj=$("#verify_passID");
            var failObj=$("#verify_failID");
            var confirmBtn=$('#upload_sureID');
            var can=check_can_submit();
            if (!can && is_upload_err)
            {
                passObj.show();
                confirmBtn.prop('disabled', false);
                failObj.hide();
            }
            else
            {
                passObj.hide();
                confirmBtn.prop('disabled', true);
                failObj.show();
            }
            $userCount.text(passUserCount + all_ids.length);
            $errorUserCount.text(can);
        }

        function getInsuranceNameByEid(eid)
        {
            for(var i=0;i<groupIns.length;i++)
            {
                if(eid==groupIns[i]['eid'])
                {
                    return groupIns[i]['insurance_name'];
                }
            }
        }
        /*获取页面上全部用户信息*/
        function getAllPageUsers()
        {
            var userArr=new Array();
            var count=0;
            $("#user_tableID tbody>tr").each(function (index)
            {
                var realname=$.trim($(this).find("input[name='data[realname][]']").val());
                var id_number=$.trim($(this).find("input[name='data[id_number][]']").val());
                var mobile=$.trim($(this).find("input[name='data[mobile][]']").val());
                var eid=$.trim($(this).find("select[name='data[insurance][]']").val());
                var starttime=$.trim($(this).find("input[name='data[starttime][]']").val());
                var endtime=$.trim($(this).find("input[name='data[endtime][]']").val());
                var aUser=new Array();
                aUser['realname']=realname;
                aUser['id_number']=id_number;
                aUser['mobile']=mobile;
                aUser['eid']=eid;
                aUser['starttime']=starttime;
                aUser['endtime']=endtime;
                userArr[count]=aUser;
                count++;
            });
            return userArr;
        }

    });
    $(document).ready(function ()
    {
        $('#loading').css('display', 'none');
        $('#content').css('display', 'block');
        $('#content1').css('display', 'block');
    });

    function directUploadClick()
    {
        loading('show');
        $('#uploadDirectBtnID').prop('disabled',true).text('正在上传，请稍后');
        $('#uploadDirectID').submit();
    }

    $("#uploadDirectBtnID2").click(function(){
        loading("show");
        //alert(111);
    })

    $("#uploadDirectBtnID3").click(function(){
        loading("show");
        //alert(111);
    })
    $("#uploadDirectBtnID4").click(function(){
        loading("show");
        //alert(111);
    })

    $('.view-user').dataTable({
        //"bLengthChange":false,
        "ordering":false,
        "searching": true,
        "bStateSave": true//状态保存
    });
</script>